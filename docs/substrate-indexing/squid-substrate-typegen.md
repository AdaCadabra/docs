---
sidebar_position: 50
description: Type-safe Substrate data handling
---

# Substrate typegen

:::warning
Interface of typegen-generated classes is under active development and _will_ change in near future.
:::

## Installation

The squid substrate typegen tool is a part of Subsquid SDK. It is used for generating TypeScript interface classes for Substrate events and calls.

## Options for `squid-substrate-typegen` command

| Argument         | Description              | Required |
| ---------------- | ------------------------ | -------- |
| `-h` or `--help` | display help for command |          |
| `config`         | JSON file with options   | yes      |

*Usage*

```bash
npx squid-substrate-typegen typegen.json
```

Within the substrate-based templates there is also an `sqd` shorthand command for executing this exact line:

```bash
sqd typegen
```

If necessary, multiple config files can be supplied:
```bash
npx squid-substrate-typegen typegen0.json typegen1.json ...
```

The `typegen.json` config file has the following structure:
```json
{
  "outDir": "src/types",
  "specVersions": "kusamaVersions.jsonl",
  "events": [
    // list of events to generate
    "Balances.Transfer"
  ],
  "calls": [
    // list of calls to generate
    "timestamp.set"
  ],
  "storage": [
    "System.Account"
    // Qualified storage item name: "${Prefix}.${item}"
  ],
  "constants": [
    // Qualified name for the constants to be generated: "${Prefix}.${item}"
  ]
}
```
The `specVersions` fields is either
 - an metadata service endpoint URL, like
   ```
   https://v2.archive.subsquid.io/metadata/{network}
   ```
   or
 - a path to a [`jsonl`](https://jsonlines.org) file generated by [`substrate-metadata-explorer(1)`](https://github.com/subsquid/squid-sdk/tree/master/substrate/substrate-metadata-explorer).


To generate all items defined by the runtime, set any of `events`, `calls`, `storage` or `constants` to `true`, e.g.

```json
{
  "outDir": "src/types",
  "specVersions": "https://v2.archive.subsquid.io/metadata/kusama",
  // generate facade classes for all runtime constants
  "constants": true
}
```

## TypeScript class wrappers

The result of the typegen command can be found in the specified `outDir` (`src/types` by default). The wrapper classes for event, calls, storage and constants are generated in `events.ts`, `calls.ts`, `storage.ts` and `constants.ts` respectively.

## Examples

Below are sample code snippets showcasing how the classes generated by typegen are used in the mappings.

### Events and Calls

```typescript
import {
  BalancesTransferEventV1020,
  BalancesTransferEventV1050,
  BalancesTransferEventV9130
} from './types/events'
import {
  BalancesForceTransferCallV1020,
  BalancesForceTransferCallV1050,
  BalancesForceTransferCallV2028,
  BalancesForceTransferCallV9111
} from './types/calls'

// ...

processor.run(new TypeormDatabase(), async ctx => {
  for (let block of ctx.blocks) {
     for (let event of block.events) {
      if (event.name == 'Balances.Transfer') {
        let rec: {from: Bytes, to: Bytes, amount: bigint}
        if (BalancesTransferEventV1020.is(event)) {
          let [from, to, amount, fee] = BalancesTransferEventV1020.decode(event)
          rec = {from, to, amount}
        }
        // ... decode all runtime versions similarly with BalancesTransferEventVXXXX.is/.decode
      }
    }
    for (let call of block.calls) {
      if (call.name == 'Balances.force_transfer') {
        let rec: {source: Bytes, dest: Bytes, value: bigint} | undefined
        if (BalancesForceTransferCallV1020.is(call)) {
          let res = BalancesForceTransferCallV1020.decode(call)
          assert(res.source.__kind === 'AccountId')
          assert(res.dest.__kind === 'AccountId')
          rec = {
            source: res.source.value,
            dest: res.dest.value,
            value: res.value
          }
        }
        // ... decode all runtime versions similarly with BalancesForceTransferCallVXXXX.is/.decode
    }
  }
})
```

### Storage

See [Storage queries](../storage-state-calls).

### Constants

```typescript
import {BalancesExistentialDepositConstV1020} from './types/constants'
// ...
processor.run(new TypeormDatabase(), async ctx => {
  for (let block of ctx.blocks) {
    let c = new BalancesExistentialDepositConstV1020.get(block.header)
    ctx.log.info(`Balances.ExistentialDeposit (runtime version V1020): ${c}`)
  }
})
```
